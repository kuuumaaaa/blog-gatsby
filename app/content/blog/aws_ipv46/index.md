---
title: AWS IPv4/IPv6の変換方法
date: "2022-06-18"
tags: ["aws","SAP"]
hero: ./AWS-Logo.svg
description: "search AWS IPv4 IPv6"
---

## はじめに
SAP対策で通信形式をIPv4対応の通信をIPv6に変換する方法について調べました。
もしご指摘あればご連絡いただければと思います。

## 前提
VPCにパブリックサブネット、プライベートサブネットを用意します。
VPCにはインタネットゲートウェイをアタッチします。
パブリックサブネットにインターネットゲートウェイ経由で通信するWEBサーバ、
プライベートサブネットにNATゲートウェイ経由で通信するデータベースサーバを作成されているものとします。
また、VPCとリソースはIPv4/IPv6のデュアルスタックモードで操作できるようにすることを最終目標とします。

## 方法
### ステップ 1: IPv6 CIDR ブロックを VPC およびサブネットと関連付ける
- "VPC"から IPv6に変更したいVPCを選択し[Add IPv6 CIDR (IPv6 CIDR の追加)] で追加します。
- また同様に、"VPC"から"サブネット”を選択し、IPv6に変更したいサブネットを選択し[Add IPv6 CIDR] で追加します。
### ステップ 2: ルートテーブルを更新する
### ステップ 3: セキュリティグループルールを更新する
### ステップ 4: インスタンスタイプを変更する
### ステップ 5: IPv6 アドレスをインスタンスに割り当てる
### ステップ 6: (オプション) インスタンスに IPv6 を設定する
 移行時ののめんどくさい作業を自動で行ってくれたり、レプリケーションしたAMIを作成してくれます。作成したAMIですぐにEC2を作成できます。GUIだけでなくAWS CLIでも移行できるようです。また移行する際には移行元のVMへSMS Connector(OVF)を導入する必要があります。
  
### 複数サーバの移行
複数のサーバを一度に移行できます。デフォルトは50 VMです。

### 増分更新
増分更新ができるため、段階的にテストを行いながら移行することができます。
これにより一度に移行する必要がないため通信量を削減できます。
また、細かな増分更新によりレプリケーション時間が短くなり結果的にダウンタイムの最小化が図れます。

### 対応OS
LinuxやWindows等さまざまなオペレーティングシステムに対応してます。

### ダウンタイムの最小化
最小限のダウンタイムで移行ができるのでビジネスインパクトを下げることができます。

## 費用
AWS SMSにかかる費用は無料。ただ作成したAMIやEC2等に費用がかかります。またDataTransferにも費用がかかるので、大規模な移行やデータ量が多い場合は注意が必要そうです。

## まとめ
SMSはVMからEC2への移行時に使用するものということで、あまりVMを使ってこなかったので勉強になりました。
ただ、今現在は[AWS Application Migration Servic](https://aws.amazon.com/jp/application-migration-service/)が推奨されているので実際に導入される方はまずそちらを検討する必要がありそうです。

## 参考
- https://docs.aws.amazon.com/ja_jp/vpc/latest/userguide/vpc-migrate-ipv6.html
- https://www.nic.ad.jp/ja/newsletter/No37/0800.html